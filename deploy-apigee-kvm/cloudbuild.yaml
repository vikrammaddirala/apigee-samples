steps:
  - name: 'gcr.io/cloud-builders/gcloud'
    id: export_kvm
    entrypoint: 'bash'
    args:
      - -c
      - |
        echo "Exporting KVM from default-dev environment..."
        export BUILD_TOKEN=$(gcloud auth print-access-token)
        curl -H "Authorization: Bearer $BUILD_TOKEN" \
             -H "Content-Type: application/json" \
             "https://apigee.googleapis.com/v1/organizations/apigee-x-379708/environments/default-dev/keyvaluemaps/YOUR_KVM_NAME" \
             -o kvm_export.json

  - name: 'gcr.io/cloud-builders/gcloud'
    id: import_kvm
    entrypoint: 'bash'
    args:
      - -c
      - |
        echo "Importing KVM to test-env environment..."
        export BUILD_TOKEN=$(gcloud auth print-access-token)
        curl -X POST -H "Authorization: Bearer $BUILD_TOKEN" \
             -H "Content-Type: application/json" \
             -d @kvm_export.json \
             "https://apigee.googleapis.com/v1/organizations/apigee-x-379708/environments/test-env/keyvaluemaps"

options:
  logging: CLOUD_LOGGING_ONLY
timeout: "600s"
